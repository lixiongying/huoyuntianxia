<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,minimum-scale=1.0">
		<title>分享赚红包</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/mui.css"/>
		<!--<link rel="stylesheet" type="text/css" href="../../css/nav_table.css"/>-->
		<link rel="stylesheet" type="text/css" href="../../css/code.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
		<script src="../../js/public.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery-1.10.2.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<script>
//		var user_id=localStorage.getItem('user_id');
	</script>
	<body>
		<header class="mui-bar mui-bar-nav mui-action-back">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #fff;"></a>
		    <h1 class="mui-title">分享赚红包</h1>
		    
		    <!--<span><img src="../../img/faxian_jia.png"/></span>-->
		</header>
		<div class="mui-content">
			<div class="main">
				<div class="main_li">
					<div class="red_packets">我的红包(元)：</div>
					<div class="money"><input type="number" id="input-test" value="" placeholder="请输入提现金额"/></div>
					<div class="main_li_withdrawals">
						<div class="withdrawals">我要提现</div>
					</div>
				</div>
				<div class="main_li main_li_code">
					<div class="invitation_code">
						<div class="code_name">&nbsp;&nbsp;邀请你成为伙伴，邀请码为：&nbsp;</div>
						<div class="code_nums">
							<div class="code codeone">8</div>
							<div class="code codetwo">8</div>
							<div class="code codethree">8</div>
							<div class="code codefour">a</div>
							<div class="code codefive">C</div>
							<div class="clear"></div>
						</div>
					</div>
				</div>
				<div class="main_li main_li_twocode">
					<div class="two_code">
						<div class="car">
							<img src="../../img/fenxiang_bg.png"/>
						</div>
						<div class="code">
							<!--<img src="../../img/20180427173649.jpg"/>-->
						</div>
					</div>
					<div class="text_title">邀请好友赚红包</div>
					<div class="text_contents">
						每邀请一个企业货主或普通货主成功注册，您将获得<span class="moneys">5</span>元红包<br/>及<span class="xunibi">5</span>个虚拟币；每邀请一位用户成功注册为司机，您将获得<span class="moneys">5</span>元红包<br/>及<span class="xunibi">5</span>个虚拟币,快去邀请好友注册吧~
					
					</div>
					<div class="share">
						<!--<div class="share_li wachat">
							<img src="../../img/fenxiang_weixin.png" alt="" />
							微信
						</div>-->
						<div class="share_li friend" onclick="shareHref()">
							<img src="../../img/fenxiang_weixin.png" alt="" />
							微信
						</div>
						
						<div class="clear"></div>
					</div>
				</div>
				<div style="display: none;">
					<textarea id="sharecontent" rows="3">我正在使用APP，赶紧跟我一起来体验！</textarea>
					<input id="sharehref" class="sharehref" type="url" value="http://hytx.sxnet.cc/index.php/Mobile/JkUser/adlink/user_id/" placeholder="请输入要分享的链接地址"/>
					<input id="sharehrefTitle" class="sharehref" type="text" value="最好的APP" placeholder="请输入要分享的链接标题"/>
					<input id="sharehrefDes" class="sharehref" type="text" value="我正在使用APP，赶紧跟我一起来体验！" placeholder="请输入要分享的链接描述"/>	
			    </div>
				<div class="main_li main_user">
					<div class="main_li_title">已邀请用户</div>
					<div class="main_li_nums">5</div>
					<div class="lateiy">最近邀请</div>
					<div class="main_li_users clearfix">
						<div class="inviteperson" style="display: none;">
							暂无邀请人数
						</div>
						<!--<div class="users_li clearfix">
							<div class="user_name">张三</div>
							<div class="user_type">普通货主</div>
							<div class="user_time">2018-05-01</div>
							<div class="clear"></div>
						</div>
						<div class="users_li">
							<div class="user_name">李四</div>
							<div class="user_type">普通货主</div>
							<div class="user_time">2018-04-01</div>
							<div class="clear"></div>
						</div>
						<div class="users_li">
							<div class="user_name">王五</div>
							<div class="user_type">企业货主</div>
							<div class="user_time">2018-03-01</div>
							<div class="clear"></div>
						</div>
						<div class="users_li">
							<div class="user_name">张三</div>
							<div class="user_type">普通货主</div>
							<div class="user_time">2018-02-01</div>
							<div class="clear"></div>
						</div>
						<div class="users_li">
							<div class="user_name">张三</div>
							<div class="user_type">普通货主</div>
							<div class="user_time">2018-01-01</div>
							<div class="clear"></div>
						</div>-->
					</div>
				</div>
			</div>
				
				
		</div>
	</body>
	<script type="text/javascript">
	var user_id=localStorage.getItem('user_id');
	$('#sharehref').val("http://hytx.sxnet.cc/index.php/Mobile/JkUser/adlink/user_id/"+user_id);
	
		$('.withdrawals').click(function(){
			
			var price=$('#input-test').val();
			
			var type=2;
			if(price==''){
				mui.toast('提现金额不能为空');
				return false;
			}else{
				$.ajax({
					type:"post",
					url:globalUrl+"index.php/Mobile/JkUser/tixina",
					data:{price:price,user_id:user_id,type:2},
					dataType:'json',
					success:function(res){
						
						
						var data=res;
						if(data.code==0){
							mui.toast('提现成功')
						}else if(data.code==1){
							mui.toast(data.msg);
						}
					}
				});
			}
			
		})
		/*红包及虚拟币*/
		$.ajax({
			type:"post",
			url:globalUrl+"index.php/Mobile/JkLg/sengxunibing",
			
			dataType:'json',
			success:function(res){
				
				var hongbao=res.hongbao.value;
				var xunibing=res.xunibing.value;
				
				$('.moneys').html(hongbao);
				$('.xunibi').html(xunibing);
			}
		})
		
		
		
		
		//邀请码
		$.ajax({
			type:"post",
			url:globalUrl+"index.php/Mobile/JkUser/shar_no",
			data:{user_id:user_id},
			dataType:'json',
			success:function(res){
				if(res.code==0){
					var data=res.root;
					var invitecode=data.promo_code.promo_code;
				    var obj = invitecode.split("");  
				    var str=''
				    $('.main_li_nums').html(data.count)
					$('.codeone').html(obj[0]);
					$('.codetwo').html(obj[1]);
					$('.codethree').html(obj[2]);
					$('.codefour').html(obj[3]);
					$('.codefive').html(obj[4]);
					
					var dataone=res.root.list;
					if(dataone==''||dataone==undefined||dataone==null){
						$('.inviteperson').show();
					}else{
						$('.inviteperson').hide();
						for(var i=0;i<dataone.length;i++){
							$('.inviteperson').hide();
							str+='<div class="users_li">';
							str+='<div class="user_name">'+dataone[i].nick_name+'</div>';
							if(dataone[i].company_status==0||dataone[i].company_status==1){
									str+='<div class="user_type">普通货主</div>';
							}else if(dataone[i].company_status==2){
								str+='<div class="user_type">企业货主</div>';
							}
						    str+='<div class="user_time">'+dataone[i].reg_time+'</div>';
						    str+='<div class="clear"></div>';
						}
						$('.main_li_users').html(str);
						var time=$('.user_time').html();
						var datatime=timeToDate(time);
						$('.user_time').html(datatime);
                        
					}
					
				}
			
			}
		});
		
		
	var shares=null,bhref=false;
var Intent=null,File=null,Uri=null,main=null;
// H5 plus事件处理
function plusReady(){
	updateSerivces();
	if(plus.os.name=="Android"){
		Intent = plus.android.importClass("android.content.Intent");
		File = plus.android.importClass("java.io.File");
		Uri = plus.android.importClass("android.net.Uri");
		main = plus.android.runtimeMainActivity();
	}
}
if(window.plus){
	plusReady();
}else{
	document.addEventListener("plusready",plusReady,false);
}
/**
 * 更新分享服务
 */
function updateSerivces(){
	plus.share.getServices( function(s){
		shares={};
		for(var i in s){
			var t=s[i];
			shares[t.id]=t;
		}
	}, function(e){
		outSet( "获取分享服务列表失败："+e.message );
	} );
}
/**
 * 调用系统分享
 * 调用
 */
function shareSystem() {
	if(plus.os.name!=="Android"){
		plus.nativeUI.alert("此平台暂不支持系统分享功能!");
		return;
	}
	var intent=new Intent(Intent.ACTION_SEND);
	var p = "";
	if(pic&&pic.realUrl){
		p = pic.realUrl;
		if(p.substr(0,7)==="file://"){
			p=p.substr(7);
		}else if(p.sub(0)!=="/"){
			p=plus.io.convertLocalFileSystemURL(p);
		}
	}
	var f = new File(p);
	var uri = Uri.fromFile(f);
	if(f.exists()&&f.isFile()){
		console.log("image/*");
		intent.setType("image/*");
		intent.putExtra(Intent.EXTRA_STREAM,uri);
	}else{
		console.log("text/plain");
		intent.setType("text/plain");
	}
	intent.putExtra(Intent.EXTRA_SUBJECT,"HBuilder");
	intent.putExtra(Intent.EXTRA_TEXT,sharecontent.value);
	intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
	main.startActivity(Intent.createChooser(intent,"系统分享"));
}
/**
   * 分享操作
   * @param {String} id
   */
function shareAction(id,ex) {
	var s=null;
//	outSet( "分享操作：" );

	if(!id||!(s=shares[id])){
		outLine( "无效的分享服务！" );
	
		return;
	}
	if ( s.authenticated ) {
//		outLine( "---已授权---" );

		shareMessage(s,ex);
	} else {
//		outLine( "---未授权---" );

		s.authorize( function(){
				shareMessage(s,ex);
			},function(e){
		//	outLine( "认证授权失败："+e.code+" - "+e.message );
		});
	}
}
/**
   * 发送分享消息
   * @param {plus.share.ShareService} s
   */
function shareMessage(s,ex){
	var msg={content:sharecontent.value,extra:{scene:ex}};
	if(bhref){
		msg.href=sharehref.value;
		if(sharehrefTitle&&sharehrefTitle.value!=""){
			msg.title=sharehrefTitle.value;
		}
		if(sharehrefDes&&sharehrefDes.value!=""){
			msg.content=sharehrefDes.value;
		}
		msg.thumbs=["_www/logo.png"];
		msg.pictures=["_www/logo.png"];
	}else{
		if(pic&&pic.realUrl){
			msg.pictures=[pic.realUrl];
		}
	}
	//outLine(JSON.stringify(msg));
	s.send( msg, function(){
		//outLine( "分享到\""+s.description+"\"成功！ " );
	}, function(e){
		//outLine( "分享到\""+s.description+"\"失败: "+e.code+" - "+e.message );
	} );
}
/**
 * 解除所有分享服务的授权
 */
function cancelAuth(){try{
	//outSet( "解除授权：" );
	for ( var i in shares ) {
		var s = shares[i];
		if ( s.authenticated ) {
			//outLine( "取消\""+s.description+"\"");
		}
		s.forbid();
	}
	// 取消授权后需要更新服务列表
	updateSerivces();
	outLine( "操作成功！" );}catch(e){alert(e);}
}

// 分析链接
		function shareHref(){
			bhref=true;
			var ids=[{id:"weixin",ex:"WXSceneSession"},{id:"weixin",ex:"WXSceneTimeline"}],
			bts=[{title:"发送给微信好友"},{title:"分享到微信朋友圈"}];
			plus.nativeUI.actionSheet({cancel:"取消",buttons:bts},
				function(e){
					var i=e.index;
					if(i>0){
						shareAction(ids[i-1].id,ids[i-1].ex);
					}
				}
			);
		}
	</script>
</html>
