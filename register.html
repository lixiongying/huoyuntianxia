<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,minimum-scale=1.0">
		<title>登录</title>
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<!--<link rel="stylesheet" type="text/css" href="css/mui.css"/>-->
		<link rel="stylesheet" type="text/css" href="css/nav_table.css"/>
		<link rel="stylesheet" type="text/css" href="css/register.css"/>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery-1.10.2.min.js" type="text/javascript" charset="utf-8"></script>

		<title></title>
	</head>
	<body>
		
		<header class="mui-bar mui-bar-nav mui-action-back">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">注册</h1>
		</header>
		<div class="mui-content">
			<div class="main">
			
				<div class="piclogo">
					<img src="img/denglu_id.png"/>
				</div>
				<div class="regiseritem">
					<div class="tel">
						<div class="picimg"><img src="img/denglu_zhanghao.png"/></div>
						<div class="inputtype"><input type="" name="phone" id="" value="" placeholder="请填写手机号码"/></div>
					</div>
					<div class="tel">
						<div class="picimg"><img src="img/denglu_mima.png"/></div>
						<div class="inputtype"><input type="password" name="" id="" value="" class="registerPass" placeholder="密码(长度6-16,须同时包含字母数字)"/></div>
					</div>
					<div class="tel">
						<div class="picimg"><img src="img/denglu_mima.png"/></div>
						<div class="inputtype"><input type="password" name="" id="" value="" class="registerPsdagain" placeholder="请再次填写登录密码"/></div>
					</div>
					<div class="tel">
						<div class="picimg"><img src="img/zhuce_yaoqingma.png"/></div>
						<div class="inputtype"><input type="" name="" id="" value="" class="authinvitecode" placeholder="请输入邀请码"/></div>
					</div>
					<div class="tel yanzhengma">
						<div class="picimg"><img src="img/zhuce_yanzhengma-.png"/></div>
						<div class="inputtype"><input type="" name="" class="authcode" id="" value="" placeholder="请输入验证码"/></div>
						<div class="code">
							获取验证码
						</div>
					</div>
				</div>
				<div class="agree">
					<div class="iagree"><img src="img/dingdanxiangqing_xuanzhong.png"/ data-type='1' class="selectpic"></div>
					<div class="agreeworld">我同意并遵守用户协议</div>
				</div>
				<div class="regiser">立即注册</div>
			</div>
		</div>
	</body>
		<script type="text/javascript">
		$(".selectpic").click(function(){
			if($(this).attr('data-type')==1){
				$(this).attr('src',"img/dingdanxiangqing_weixuanzhong.png");
				$(this).attr('data-type',2);
			}else{
				$(this).attr('src',"img/dingdanxiangqing_xuanzhong.png");
				$(this).attr('data-type',1)
			}
			
		})
		

		//发送验证码
    	 $('.code').click(function(){
    	 	 			
    	 	var $registerMoblie=$('input[name="phone"]').val();/*手机号码*/
		    var $authcode=$('.authcode').val().trim();/*验证码*/		   
	    	var $codename=$('.Code').html();
    	 	var parms={};
    	 	
    	 	parms.mobile=$registerMoblie;
    	 	
    	     if($registerMoblie==''){
    	     	mui.toast('请输入手机号码');
    	     	return false;
    	     }
    	     if(!isPoneAvailable($registerMoblie)){
    	     	mui.toast('手机号码格式错误！');
    	     	return false;
    	     }else{
    	     	$.ajax({
    	     		url:globalUrl+'index.php/Mobile/JkLg/sendSms',
    	     		type:'post',
    	     		data:parms,
    	     		datatype:'json',
    	     		success:function(data){  	     			
    	     			if(data.code==0){
    	     				mui.toast(data.msg)
    	     				var time = 120;
				 			var countdown = setInterval(countDown,1000);
				 			function countDown(){
				 				$('.code').html(time+'秒后失效');
				     			if(time==0){
				     				$('.code').html('发送验证码');
				     				clearInterval(countdown);
				     			}
				     			time--
				 			}
    	     			}
    	     		}
    	     	})
    	     }
    	   
         })

      /*立即注册*/
		 $('.regiser').click(function(){
	       	 var $authinvitecode=$('.authinvitecode').val().trim();/*验证邀请码*/
			 var $registerPass=$('.registerPass').val().trim();/*密码*/
			 var $registerPsdagain=$('.registerPsdagain').val().trim();/*再次输密码*/
	       	 var parms={};
	       	 var $authcode=$('.authcode').val();
	       	 var type=$(".selectpic").attr('data-type');
	      
	       	 if($('.authcode').val()==''){
	       	  	mui.toast('请输入验证码');
	       	  	return;
	       	  }
	       	 if(!isPassword($registerPass)){
	       	  	mui.toast('密码格式错误');
	       	  	return;
	       	  }
	       	 
	       	 if($registerPass!=$registerPsdagain){
	       	  	mui.toast('两次输入的密码不一致，请重新输入');
	       	  	return;
	       	  }
	       	 if(type==2){
	       	 	mui.toast('请勾选我同意并遵守用户协议');
	       	  	return;
	       	 }
	       	  parms.mobile=$('input[name="phone"]').val();      	
	       	  parms.password=$registerPass;
	       	  parms.code=$('.authcode').val();
	       	  parms.topPromoCode=$authinvitecode;
	       
	       	  mui.ajax({
	       	  	url:globalUrl+'index.php/Mobile/JkLg/register',
	       	  	type:'post',
	       	  	data:parms,
				dataType:'json',
				success:function(res){
					alert(JSON.stringify(res))
					if(res.code==1){
						mui.toast(res.msg)
					}else{
						mui.toast('注册成功');
						location.href="login.html";
						
					}
				}
				
	       	  })
	       	 
	       })
        
		</script>
</html>